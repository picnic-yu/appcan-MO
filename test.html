<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<title></title>
		<link rel="stylesheet" href="css/fonts/font-awesome.min.css">
        <link rel="stylesheet" href="css/ui-box.css">
        <link rel="stylesheet" href="css/ui-base.css">
        <link rel="stylesheet" href="css/ui-color.css">
        <link rel="stylesheet" href="css/appcan.icon.css">
        <link rel="stylesheet" href="css/appcan.control.css">
		<style type="text/css">
			.item{
			    display:flex;
                justify-items: center;
                align-items: center;
                margin-top:3vh;
                color:#00a0e8;
                
                
            }
            img{
                display: block;
            }
            .wrap{
                
                   margin: 0 auto;
                   padding-top:10vh;
            }
		</style>
	</head>
	<body>
	    <div class="uh bc-head  ubb bc-border" data-control="HEADER" >
            <div class="ub">
                <div class="nav-btn" id="nav-left">
                    <div class="fa fa-1g ub-img1" onclick='toggle()'>
                        <img src="image/bread.png"/>
                    </div>
                </div>
                <h1 class="ut ub-f1 ulev-3 ut-s tx-c" tabindex="0">重新激活</h1>
                <div class="nav-btn" id="nav-right">
                    <div class="fa  fa-1g  ub-img1">
                    </div>
                </div>
            </div>
        </div>
	    <div  class='wrap'>
            
            <div  class='item-wrap'>
                
            
                <div class='item' >
                    <img src="image/icon_login.png"/>
                    <span >
                                                    登陆激活
                    </span>
                </div>
                <div class='item' onclick='handleScan()'>
                    <img src="image/scan.png"/>
                    <span >
                                                    扫码激活
                    </span>
                </div>
                <div class='item' onclick='handlePickImage()'>
                    <img src="image/image.png"/>
                    <span >
                                                    读图激活
                    </span>
                </div>
            </div>
        </div>

	</body>
</html>

<script src="js/aes.js"></script>
<script src="js/appcan.js">
        </script>
        <script src="js/appcan.control.js">
        </script>
        <script src="js/appcan.scrollbox.js">
        </script>
        <script src="js/template.import.js">
        </script>
        <script src="./assets/mvvm/index.js">
        </script>
        <script src="./js/index.js">
        </script>
<!-- 日期转化 -->
<script src="js/date.js">
</script>
<script type="text/javascript" charset="utf-8">


//aes解密和加密开始


var _key = CryptoJS.enc.Utf8.parse("T#s)STq~whp]b52G"); 
var _iv = CryptoJS.enc.Utf8.parse('Yw*M3^6JpV%0U@qk'); 

/**
 * 加密（需要先加载lib/aes/aes.min.js文件）
 * @param word
 * @returns {*}
 */
function encrypt(word){
    var srcs = CryptoJS.enc.Utf8.parse(word);
    var encrypted = CryptoJS.AES.encrypt(srcs, _key, {iv:_iv,mode:CryptoJS.mode.CBC,padding: CryptoJS.pad.Pkcs7});
    return encrypted.toString();
}

/**
 * 解密
 * @param word
 * @returns {*}
 */
function decrypt(word){
    var decrypt = CryptoJS.AES.decrypt(word, _key, {iv:_iv,mode:CryptoJS.mode.CBC,padding: CryptoJS.pad.Pkcs7});
    return CryptoJS.enc.Utf8.stringify(decrypt).toString();
}

//aes解密和加密结束

        // window.uexOnload = function(type){
// 
//             
// 
            // var name = uexWidgetOne.platformName;
//             
            // var params  = {
//                 
                // leftSliding:{
                    // width:0,
                    // url:"draw.html"
                // }
//                 
            // };
//             
            // var paramStr = JSON.stringify(params);
//             
            // uexWindow.setSlidingWindow(paramStr);
//             
//             
        // }
function ScannerSuccessCallBack(opCode, dataType, data) {
 
    
    data = JSON.parse(data);
    var str = data.code.split(" ");
    parseCode(str);
    
}
//解析二维码数据
function parseCode (str) {
    
    
    if(str.length == 5){
       //服务号
       var imagesn = str[0];
       
       //令牌号
       var num = str[1];
       
       //标识
       var info = decrypt(str[2]);
       
       //有效期
       var validtime = decrypt(str[3]).toString();
       alert(validtime)
       //种子
       var desp = decrypt(str[4]);
      
       if(info == 'JSHS'){
            //判断二维码是否在有效期
            var now = new Date().Format("yyyy-MM-dd hh:mm:ss");
            var cvalidtime = validtime.slice(0,4)+'-'+validtime.slice(4,6)+'-'+validtime.slice(6,8)+' '+validtime.slice(8,10)+':'+validtime.slice(10,12)+':00';

            if(now>cvalidtime){
                appcan.locStorage.val('imagesn',imagesn);
                appcan.locStorage.val('num',num);
                appcan.locStorage.val('desp',desp);
                
               
                                        //解析成功后跳转到首页
                uexWindow.open('index', '0', "index.html", '2', '', '', 0);
            }else{
                alert('二维码过期')
            }
       }else{
          // 无效标识
       }
       
    }else{
        //无效二维码
    }
}
function handleSaveCode (){
    
}
function handleScan () {

    uexScanner.open();
}
function handlePickImage() {
     
    var data = {
        min:1,
        max:1,
        quality:1,
        detailedInfo:true
    }
    var json = JSON.stringify(data);
    uexImage.openPicker(json)
 
}


function toggle () {
    var params  = {
        mark:0,
        reload:1
    };
    uexWindow.toggleSlidingWindow(params);
}

window.uexOnload = function(){

    uexScanner.cbOpen = ScannerSuccessCallBack;
    
    uexImage.onPickerClosed=function(info){
        
        info = JSON.parse(info);
        if(info.data.length){
            var url = info.data[0];  
            var result = uexScanner.recognizeFromImage(url);  
            alert(result)
            var str = result.split(" ");
            parseCode(str);
        }
        
    }
    
}
	// uexWindow.setMultilPopoverFlippingEnbaled(1)
	
	
	
</script>
